# WP-CLI Dashboard Plugin

WordPressの管理画面上でWP-CLIコマンドを実行できるプラグインです。ターミナル風のインタラクティブなインターフェイスを提供し、サーバーにSSHアクセスすることなくWP-CLIコマンドを実行できます。

![Plugin Screenshot](screenshot.png)

## 特徴

### 🖥️ ターミナル風インターフェイス
- ダークテーマの本格的なターミナル風UI
- リアルタイムでのコマンド実行結果表示
- 等幅フォントでの見やすい出力

### ⌨️ インタラクティブ操作
- **Enter**キーでコマンド実行
- **↑/↓**キーでコマンド履歴の移動
- 自動フォーカス機能

### 📦 WP-CLI内蔵
- WP-CLI pharファイルの自動ダウンロード機能
- プラグイン内にWP-CLIを内蔵可能
- 外部インストール不要

### 🔒 セキュリティ
- 管理者権限でのアクセス制限
- nonce認証によるCSRF対策
- 危険なコマンドの実行制限

## インストール

1. このプラグインをWordPressの`wp-content/plugins/`ディレクトリにアップロード
2. WordPressの管理画面でプラグインを有効化
3. 「ツール」→「WP-CLI」にアクセス

## 使用方法

### 基本的な使い方

1. WordPress管理画面の「ツール」メニューから「WP-CLI」をクリック
2. ターミナル画面でWP-CLIコマンドを入力（`wp`は不要）
3. Enterキーを押してコマンドを実行

### コマンド例

```bash
# オプションの一覧表示
option list

# ユーザー一覧表示
user list

# プラグイン一覧表示
plugin list

# キャッシュクリア
cache flush

# データベース最適化
db optimize

# サイト情報表示
core version
```

### WP-CLIが見つからない場合

プラグイン画面に「WP-CLIが見つかりません」と表示された場合：

1. 「WP-CLI pharファイルをダウンロード」ボタンをクリック
2. 自動的にWP-CLI pharファイルがダウンロードされます
3. ページを再読み込みして利用開始

## 機能詳細

### サポートするWP-CLI実行方式

1. **WordPress内蔵WP-CLIクラス**（優先）
2. **プラグイン内蔵wp-cli.phar**
3. **システムインストールされたWP-CLI**
4. **WordPressルートディレクトリのwp-cli.phar**

### キーボードショートカット

- **Enter**: コマンド実行
- **↑**: 前のコマンドを履歴から呼び出し
- **↓**: 次のコマンドを履歴から呼び出し

### セキュリティ制限

以下のような危険なコマンド・文字列を含む実行は制限されています：
- `rm`, `del`, `format`
- `sudo`, `chmod`, `chown`
- リダイレクト記号: `>`, `>>`
- パイプ: `|`
- コマンド連結: `&`, `;`

## 技術仕様

### 要件

- WordPress 4.6以上
- PHP 7.0以上
- 管理者権限

### ファイル構成

```
wp-cli-plugin/
├── dashboard-wp-cli.php    # メインプラグインファイル
├── wp-cli.phar            # WP-CLI実行ファイル（自動ダウンロード）
└── README.md              # このファイル
```

### 主要クラス・機能

- `DashboardWPCLI`: メインクラス
- `add_admin_menu()`: 管理画面メニュー追加
- `execute_wpcli_command()`: WP-CLIコマンド実行
- `download_wpcli_phar()`: WP-CLI自動ダウンロード
- `is_wpcli_available()`: WP-CLI利用可能性チェック

## デバッグ

コマンド実行時に問題が発生した場合、以下の詳細情報が表示されます：

- 実行されたコマンド
- 完全なコマンドライン
- WP-CLIのパス
- WordPressのパス
- 実行結果

## トラブルシューティング

### WP-CLIが見つからない

**症状**: 「WP-CLIが利用できません」エラー

**解決方法**:
1. 「WP-CLI pharファイルをダウンロード」ボタンをクリック
2. 手動でwp-cli.pharをプラグインディレクトリまたはWordPressルートに配置
3. システムレベルでWP-CLIをインストール

### コマンド実行エラー

**症状**: コマンドが正常に実行されない

**確認事項**:
1. PHP関数`shell_exec()`が有効化されている
2. ファイル権限が適切に設定されている
3. サーバーのセキュリティ制限

### 表示の問題

**症状**: ターミナル画面が正しく表示されない

**解決方法**:
1. ブラウザのキャッシュをクリア
2. JavaScriptが有効になっていることを確認
3. ブラウザの開発者ツールでエラーを確認

## ライセンス

GPL v2 or later

## 作者

開発者情報をここに記載

## 更新履歴

### 1.0.0
- 初回リリース
- ターミナル風インターフェイス実装
- WP-CLI自動ダウンロード機能
- コマンド履歴機能
- セキュリティ機能

## サポート

バグ報告や機能要望は、GitHubのIssuesページまでお願いします。

## 貢献

プルリクエストやバグ報告を歓迎します。開発に参加する場合は、以下のガイドラインに従ってください：

1. フォークしてブランチを作成
2. 変更をコミット
3. プルリクエストを送信

## 免責事項

このプラグインの使用によって生じたいかなる損害についても、作者は責任を負いません。本番環境での使用前に、必ずテスト環境で動作を確認してください。